CREATE OR REPLACE VIEW JAX_VW_LIST_BENEFICIARY
AS SELECT D.BENEFICARY_RELATIONSHIP_SEQ_ID IDNO,
             A.BENEFICARY_MASTER_SEQ_ID,  
             A.APPLICATION_COUNTRY_ID, 
             D.FIRST_NAME,
             D.SECOND_NAME,       
             D.THIRD_NAME,    
             D.FOURTH_NAME, 
             D.FIFTH_NAME,      
             A.BENEFICARY_STATUS_ID,   
             A.NATIONALITY, 
             (SELECT NATIONALITY FROM FS_COUNTRY_MASTER_DESC WHERE COUNTRY_ID = A.NATIONALITY AND LANGUAGE_ID = 1) NATIONALITY_NAME,
             A.DATE_OF_BIRTH,             
             A.YEAR_OF_BIRTH,      
             A.AGE, 
             A.OCCUPATION,  
             A.STATE_ID,
             A.DISTRICT_ID,
             A.CITY_ID,  
             DF_GET_STATE_DESC(A.STATE_ID,1) STATE_NAME, 
             DF_GET_DISTRICT_DESC(A.DISTRICT_ID,1) DISTRICT_NAME,
             DF_GET_CITY_DESC(A.CITY_ID,1) CITY_NAME,          
             A.NO_OF_REMITTANCE,    
             D.ISACTIVE,
             A.CREATED_BY,        
             D.CREATED_DATE,       
             A.MODIFIED_BY,
             A.MODIFIED_DATE,      
             A.COUNTRY_ID,    
             DF_GET_COUNTRY_DESC(A.COUNTRY_ID,1) COUNTRY_NAME,   
             A.BENEFICARY_STATUS_NAME,
             D.FIRST_NAME_LOCAL,       
             D.SECOND_NAME_LOCAL,      
             D.THIRD_NAME_LOCAL,
             D.FOURTH_NAME_LOCAL,      
             D.FIFTH_NAME_LOCAL,   
             A.REMARKS,
             B.BENEFICARY_COUNTRY,  
             (SELECT CMD.COUNTRY_NAME FROM FS_COUNTRY_MASTER_DESC CMD WHERE CMD.COUNTRY_ID   = B.BENEFICARY_COUNTRY AND CMD.LANGUAGE_ID  =1) BENEFICARY_BANK_COUNTRY_NAME, 
             B.BANK_ID,   
             (SELECT BM.BANK_FULL_NAME FROM EX_BANK_MASTER BM WHERE BM.BANK_ID = B.BANK_ID) BANK_NAME,
             (SELECT BMS.BANK_SHORT_NAME FROM EX_BANK_MASTER BMS WHERE BMS.BANK_ID = B.BANK_ID) BANK_SHORT_NAME,
             B.BANK_BRANCH_ID,
             (SELECT BB.BRANCH_FULL_NAME  FROM EX_BANK_BRANCH BB WHERE BB.BANK_ID=B.BANK_ID AND BB.BANK_BRANCH_ID = B.BANK_BRANCH_ID) BANK_BRANCH_NAME,
             B.BANK_ACCOUNT_NUMBER,     
             B.CURRENCY_ID,
             (SELECT CM.CURRENCY_NAME FROM EX_CURRENCY_MASTER CM WHERE CM.CURRENCY_ID = B.CURRENCY_ID) CURRENCY_NAME,
             B.ISACTIVE ACCOUNT_STATUS,
             B.BRANCH_CODE,   
             B.BANK_CODE,   
             B.SERVICE_PROVIDER,
             B.SERVICE_GROUP_ID,                 
             D.CUSTOMER_ID,
             SUBSTR(TRIM(D.FIRST_NAME||' '||D.SECOND_NAME||' '||D.THIRD_NAME||' '||D.FOURTH_NAME||' '||D.FIFTH_NAME),1,200) BENE_NAME,
             SUBSTR(TRIM(D.FIRST_NAME_LOCAL||' '||D.SECOND_NAME_LOCAL||' '||D.THIRD_NAME_LOCAL||' '||
                         D.FOURTH_NAME_LOCAL||' '||D.FIFTH_NAME_LOCAL),1,200) AR_BENE_NAME,
             D.RELATIONS_ID RELATIONSHIP_ID, 
             EX_FN_GET_RELATION_NAME(D.RELATIONS_ID) RELATION_NAME, 
             (SELECT SG.SERVICE_GROUP_CODE FROM EX_SERVICE_GROUP SG WHERE SG.SERVICE_GROUP_ID  = B.SERVICE_GROUP_ID) SERVICE_GROUP_CODE,
             (select SGD.SERVICE_GROUP_DESC from EX_SERVICE_GROUP_DESC SGD where SGD.SERVICE_GROUP_ID=B.SERVICE_GROUP_ID and SGD.language_id=1) SERVICE_GROUP_NAME,
             (SELECT E.QUOTE_NAME  FROM EX_CURRENCY_MASTER E WHERE E.CURRENCY_ID = B.CURRENCY_ID)   CURRENCY_QUOTE_NAME,
             B.BENEFICARY_ACCOUNT_SEQ_ID, 
             D.BENEFICARY_RELATIONSHIP_SEQ_ID,
             B.CREATION_TYPE,
             B.LAST_JAVA_REMITTANCE,
             D.MAP_BENE_SEQ,
             B.LAST_EMOS_REMITTANCE,
             B.BANK_ACCOUNT_TYPE_ID,
             B.SWIFT_BIC,
         A.BUILDING_NO,    
         A.FLAT,           
         A.STREET, 
         NVL(D.ORS_STATUS,0) ORS_STATUS,
         NVL(D.TOT_TRNX,0) TOT_TRNX ,
         D.MY_FAVOURITE_BENE  
        FROM EX_BENEFICARY_MASTER  A,
             EX_BENEFICARY_ACCOUNT B,
             EX_BENEFICARY_RELATIONSHIP D
       WHERE A.BENEFICARY_MASTER_SEQ_ID = B.BENEFICARY_MASTER_SEQ_ID
         AND A.BENEFICARY_MASTER_SEQ_ID = D.BENEFICARY_MASTER_SEQ_ID
         AND B.BENEFICARY_ACCOUNT_SEQ_ID  = D.BENEFICARY_ACCOUNT_SEQ_ID
         AND ( NVL(A.ISACTIVE,' ') = 'Y' OR NVL(A.ISACTIVE,' ') = 'D')
         AND ( NVL(B.ISACTIVE,' ') = 'Y' OR NVL(B.ISACTIVE,' ') = 'D')
         AND ( NVL(D.ISACTIVE,' ') = 'Y' OR NVL(D.ISACTIVE,' ') = 'D')
         and bank_id <>2677;
